---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import CustomEl from '../components/CustomEl.astro';
---

<Layout title="CSE 134B - VyDang">
    <h2>‚öôÔ∏è Garage Manager ‚öôÔ∏è</h2>

    <!-- CRUD Form -->
    <section class="crud-container">
        <form id="crud-form" class="crud-form">
            <h3 id="form-title">Add New Car</h3>
            
            <input type="hidden" id="car-index" value="">
            
            <label for="car-title">Car Title *</label>
            <input 
                type="text" 
                id="car-title" 
                name="title" 
                maxlength="55"
                required 
                placeholder="e.g., Mazda RX7">
            
            <label for="car-img">Image URL *</label>
            <input 
                type="url" 
                id="car-img" 
                name="img" 
                required 
                placeholder="https://example.com/car.jpg or resources/cars/car.jpg">
            
            <label for="car-description">Description</label>
            <textarea 
                id="car-description" 
                name="car-description" 
                rows="4"
                maxlength="300"
                placeholder="Tell us about this car up to 300 characters"></textarea>
                <output class="info" id="comment-info">300 characters remaining</output>

            <label for="car-link">Learn More Link</label>
            <input 
                type="url" 
                id="car-link" 
                name="link" 
                placeholder="https://en.wikipedia.org/wiki/...">
            
            <div class="form-actions">
                <button type="submit" id="submit-btn" class="btn btn-primary">Add Car</button>
                <button type="button" id="cancel-btn" class="btn btn-secondary" style="display:none;">Cancel</button>
            </div>
        </form>
    </section>

    <!-- Current Cars List -->
    <section class="cars-list-container">
        <div class="list-header">
            <h3>Current Cars in Storage</h3>
            <button id="refresh-list" class="btn btn-small">üîÑ Refresh</button>
        </div>
        
        <div id="cars-list" class="cars-list">
            <!-- Cars will be listed here -->
        </div>
    </section>

    <!-- Back to Gallery Link -->
    <a href="/cars.html" >‚¨Ö Back to Gallery</a>



<script is:inline src="/crud-manager.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // This function updates the character counter and warns near the limit
        // @param {Event} e - Input event from the comments textarea
        // @return {void}
        function handleCommentInput(e) {
            const comments = e.target;
            const commentInfo = document.getElementById('comment-info');
            const maxLength = comments.getAttribute('maxlength');
            const remaining = maxLength - comments.value.length;

            commentInfo.textContent = `${remaining} characters remaining`;

            // Reset classes
            commentInfo.classList.remove('warn', 'error');
            comments.classList.remove('warn', 'error');

            // Apply warning or error styling near limit
            if (remaining <= 0) {
                commentInfo.classList.add('error');
                comments.classList.add('error');
                comments.setCustomValidity('You have reached the maximum character limit!');
            } else {
                comments.setCustomValidity('');
            }
        }
        // Bind character counter listener
        const comments = document.getElementById('car-description');
        comments.addEventListener('input', handleCommentInput);

    });
    
</script>

  <CustomEl />
</Layout>